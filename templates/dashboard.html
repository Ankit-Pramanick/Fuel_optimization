<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AI Fuel Dashboard</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #e8f5f2, #f4fbff);
        }

        .card-custom {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        h5 {
            font-weight: 600;
        }
    </style>
</head>
<body>

<div class="container py-5">

    <h2 class="fw-bold text-center mb-4">
        AI-Based Fuel Efficiency Dashboard
    </h2>

    <!-- KPI CARDS -->
    <div class="row g-4 mb-4">

        <div class="col-md-4">
            <div class="card-custom text-center">
                <h6 class="text-muted">Total Fuel Consumption</h6>
                <h3 class="fw-bold text-success" id="fuelValue">--</h3>
                <p class="text-muted">L / 100 km</p>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card-custom text-center">
                <h6 class="text-muted">Estimated Distance</h6>
                <h3 class="fw-bold" id="distanceValue">--</h3>
                <p class="text-muted">km</p>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card-custom text-center">
                <h6 class="text-muted">Estimated Time</h6>
                <h3 class="fw-bold" id="timeValue">--</h3>
                <p class="text-muted">minutes</p>
            </div>
        </div>

    </div>

    <!-- CHART -->
    <div class="card-custom mb-4">
        <h5 class="mb-3">Segment-wise Fuel Consumption</h5>
        <canvas id="fuelChart"></canvas>
    </div>

    <!-- AI INSIGHT -->
    <div class="card-custom">
        <h5>AI Insight</h5>
        <p id="aiInsight" class="mb-0"></p>
    </div>

</div>

<script>

    const stored = localStorage.getItem("routeFuel");

    if (stored) {

        const data = JSON.parse(stored);

        const segmentFuel = data.segment_fuel;
        const totalFuel = data.total_fuel;

        // ----- UPDATE KPI VALUES -----

        document.getElementById("fuelValue").innerText =
            totalFuel.toFixed(2);

        // Demo dynamic distance & time calculation
        const distance = segmentFuel.length * 10; 
        const time = segmentFuel.length * 8;

        document.getElementById("distanceValue").innerText = distance;
        document.getElementById("timeValue").innerText = time;

        // ----- CHART -----

        const ctx = document.getElementById('fuelChart');

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: segmentFuel.map((_, i) => "Segment " + (i+1)),
                datasets: [{
                    label: 'Fuel Consumption',
                    data: segmentFuel
                }]
            },
            options: {
                responsive: true
            }
        });

        // ----- AI INSIGHT -----

        let insight;

        if (totalFuel < 5) {
            insight = "This route demonstrates high fuel efficiency with optimized driving conditions.";
        } 
        else if (totalFuel < 8) {
            insight = "Fuel consumption is moderate. Minor improvements in speed consistency may improve efficiency.";
        } 
        else {
            insight = "Fuel consumption is relatively high. Consider smoother acceleration and reduced idle time.";
        }

        document.getElementById("aiInsight").innerText = insight;
    }

</script>

</body>
</html>
